import j from"node:http";var v=class{routes;constructor(){this.routes=[]}add(e,t,r){let s=r.pop();this.routes.push({method:e,path:t,middlewares:r,middleware:s})}find(e){let{method:t,url:r,params:s}=e;if(!r)return;let i=this.routes.find(o=>{let d=new RegExp("^"+o.path.replace(/\/:([^\/]+)/g,"/([^/]+)")+"$");return t===o.method&&d.test(r.split("?")[0])});if(i){let o=r.split("?")[0].match(new RegExp(i.path.replace(/\/:([^\/]+)/g,"/([^/]+)")));if(o){let d=(i.path.match(/\/:([^\/]+)/g)||[]).map(p=>p.replace("/:",""));e.params=e.params||{},d.forEach((p,l)=>{e.params[p]=o[l+1]})}}return i}get(e,...t){this.add("GET",e,t)}post(e,...t){this.add("POST",e,t)}put(e,...t){this.add("PUT",e,t)}patch(e,...t){this.add("PATCH",e,t)}delete(e,...t){this.add("DELETE",e,t)}},C=v;var m=class{parse(e){let t=e.secure?"https":e.headers["x-forwarded-proto"]||"http",r=e.url?new URL(e.url,`${t}://${e.headers.host}`):new URL(`${t}://${e.headers.host}`);return Object.fromEntries(r.searchParams.entries())}};var c=class{process(e,t,r){let s=r.find(e);if(!s){t.statusCode=404,t.end("Not Found");return}(async()=>{try{for(let o of s.middlewares)await new Promise((d,p)=>{o(e,t,l=>l?p(l):d())});s.middleware?s.middleware(e,t,()=>{}):(t.statusCode=500,t.end("Internal Server Error: No controller provided"))}catch(o){let d=o instanceof Error?o.message:"Unknown Error";t.statusCode=500,t.end(`Internal Server Error: ${d}`)}})()}};var y=class{constructor(e,t,r=new m,s=new c){this.middlewares=e;this.router=t;this.queryParams=r;this.processRouter=s}async handleRequest(e,t){e.params={},e.query=this.queryParams.parse(e);for(let r of this.middlewares)await new Promise((s,i)=>{r(e,t,o=>o?i(o):s())});await this.processRouter.process(e,t,this.router)}},T=y;var $=async(a,e,t)=>{if((a.method==="POST"||a.method==="PUT"||a.method==="PATCH")&&a.headers["content-type"]?.startsWith("application/json"))try{a.body=await new Promise((r,s)=>{let i="";a.on("data",o=>{i+=o.toString()}),a.on("end",()=>{try{r(JSON.parse(i))}catch(o){s(o)}}),a.on("error",o=>{s(o)})})}catch(r){r instanceof Error?(e.statusCode=400,e.end(`Erro no parse do JSON: ${r.message}`)):(e.statusCode=400,e.end("Erro desconhecido no parse do JSON"));return}t()},b=$;import g from"fs";import M from"path";var F=a=>{let e=M.resolve(a.path);return g.existsSync(e)||g.mkdirSync(e,{recursive:!0}),(t,r,s)=>{if(r.locals||(r.locals={}),t.method==="POST"&&t.headers["content-type"]&&t.headers["content-type"].startsWith("multipart/form-data")){let o=t.headers["content-type"]?.split("; ")[1]?.replace("boundary=","");if(!o)return r.statusCode=400,r.end("Boundary ausente no content-type");let d=[],p=0,l=a.maxFileSize||50*1024*1024;t.on("data",n=>{if(p+=n.length,p>l)return r.statusCode=413,r.end("Arquivo muito grande");d.push(n)}),t.on("end",()=>{try{let n=Buffer.concat(d),f=Buffer.from(`--${o}`),u=0,h=[];for(;(u=n.indexOf(f,u))!==-1;){u+=f.length;let I=n.indexOf(f,u),w=n.slice(u,I!==-1?I:n.length),R=w.indexOf(`\r
\r
`);if(R===-1)break;let U=w.slice(0,R).toString("utf8"),H=w.slice(R+4),E=U.match(/filename="([^"]+)"/);if(E){let S=E[1],N=a.format||M.extname(S),P=S;P+=N;let O=M.join(e,P);g.writeFileSync(O,H),h.push(O)}if(I===-1)break}t.files=h,r.locals.uploadedFilePaths=h,s()}catch(n){console.error("Erro no upload:",n),r.statusCode=500,r.end("Erro no upload")}}),t.on("error",n=>{console.error("Erro no upload:",n),r.statusCode=500,r.end("Erro no upload")})}else s()}},B=F;var x=class{middlewares;router;requestHandler;server;constructor(){this.middlewares=[],this.router=new C,this.requestHandler=new T(this.middlewares,this.router),this.server=j.createServer((e,t)=>{let r=e,s=t;this.requestHandler.handleRequest(r,s)})}use(e){this.middlewares.push(e)}json(){return b}upload(e){return B(e)}get(e,...t){this.router.get(e,...t)}post(e,...t){this.router.post(e,...t)}put(e,...t){this.router.put(e,...t)}patch(e,...t){this.router.patch(e,...t)}delete(e,...t){this.router.delete(e,...t)}listen(e,t){this.server.listen(e,t)}},Y=x;export{Y as default};
