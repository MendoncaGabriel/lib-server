import A from"node:http";var w=class{routes;constructor(){this.routes=[]}add(e,t,o){let s=o.pop();this.routes.push({method:e,path:t,middlewares:o,middleware:s})}find(e){let{method:t,url:o,params:s}=e;if(!o)return;let a=this.routes.find(n=>{let p=new RegExp("^"+n.path.replace(/\/:([^\/]+)/g,"/([^/]+)")+"$");return t===n.method&&p.test(o.split("?")[0])});if(a){let n=o.split("?")[0].match(new RegExp(a.path.replace(/\/:([^\/]+)/g,"/([^/]+)")));if(n){let p=(a.path.match(/\/:([^\/]+)/g)||[]).map(d=>d.replace("/:",""));e.params=e.params||{},p.forEach((d,u)=>{e.params[d]=n[u+1]})}}return a}get(e,...t){this.add("GET",e,t)}post(e,...t){this.add("POST",e,t)}put(e,...t){this.add("PUT",e,t)}patch(e,...t){this.add("PATCH",e,t)}delete(e,...t){this.add("DELETE",e,t)}},E=w;var c=class{parse(e){let t=e.secure?"https":e.headers["x-forwarded-proto"]||"http",o=e.url?new URL(e.url,`${t}://${e.headers.host}`):new URL(`${t}://${e.headers.host}`);return Object.fromEntries(o.searchParams.entries())}};var f=class{async process(e,t,o){let s=o.find(e);if(!s){t.statusCode=404,t.end("Not Found");return}try{for(let a of s.middlewares)await new Promise((n,p)=>{a(e,t,d=>d?p(d):n())});s.middleware?s.middleware(e,t,()=>{}):(t.statusCode=500,t.end("Internal Server Error: No controller provided"))}catch(a){let n=a instanceof Error?a.message:"Unknown Error";t.statusCode=500,t.end(`Internal Server Error: ${n}`)}}};var v=class{constructor(e,t,o=new c,s=new f){this.middlewares=e;this.router=t;this.queryParams=o;this.processRouter=s}async handleRequest(e,t){e.params={},e.query=this.queryParams.parse(e);for(let o of this.middlewares)await new Promise((s,a)=>{o(e,t,n=>n?a(n):s())});await this.processRouter.process(e,t,this.router)}},k=v;var z=async(r,e,t)=>{if((r.method==="POST"||r.method==="PUT"||r.method==="PATCH")&&r.headers["content-type"]?.startsWith("application/json"))try{r.body=await new Promise((o,s)=>{let a="";r.on("data",n=>{a+=n.toString()}),r.on("end",()=>{try{o(JSON.parse(a))}catch(n){s(n)}}),r.on("error",n=>{s(n)})})}catch(o){o instanceof Error?(e.statusCode=400,e.end(`Erro no parse do JSON: ${o.message}`)):(e.statusCode=400,e.end("Erro desconhecido no parse do JSON"));return}t()},P=z;import x from"fs";import b from"path";var F=r=>{let e=b.resolve(r.path);return x.existsSync(e)||x.mkdirSync(e,{recursive:!0}),(t,o,s)=>{if(o.locals||(o.locals={}),t.method==="POST"&&t.headers["content-type"]&&t.headers["content-type"].startsWith("multipart/form-data")){let n=t.headers["content-type"]?.split("; ")[1]?.replace("boundary=","");if(!n)return o.statusCode=400,o.end("Boundary ausente no content-type");let p=[],d=0,u=r.maxFileSize||50*1024*1024;t.on("data",i=>{if(d+=i.length,d>u)return o.statusCode=413,o.end("Arquivo muito grande");p.push(i)}),t.on("end",()=>{try{let i=Buffer.concat(p),h=Buffer.from(`--${n}`),l=0,I=[];for(;(l=i.indexOf(h,l))!==-1;){l+=h.length;let R=i.indexOf(h,l),y=i.slice(l,R!==-1?R:i.length),g=y.indexOf(`\r
\r
`);if(g===-1)break;let N=y.slice(0,g).toString("utf8"),U=y.slice(g+4),S=N.match(/filename="([^"]+)"/);if(S){let T=S[1],$=r.format||b.extname(T),H=T;H+=$;let M=b.join(e,H);x.writeFileSync(M,U),I.push(M)}if(R===-1)break}t.files=I,o.locals.uploadedFilePaths=I,s()}catch(i){console.error("Erro no upload:",i),o.statusCode=500,o.end("Erro no upload")}}),t.on("error",i=>{console.error("Erro no upload:",i),o.statusCode=500,o.end("Erro no upload")})}else s()}},B=F;function m(r,e){switch(e){case"json":r.setHeader("Content-Type","application/json");break;case"html":r.setHeader("Content-Type","text/html");break;case"text":r.setHeader("Content-Type","text/plain");break;case"binary":r.setHeader("Content-Type","application/octet-stream");break;case"css":r.setHeader("Content-Type","text/css");break;case"js":r.setHeader("Content-Type","application/javascript");break;case"xml":r.setHeader("Content-Type","application/xml");break;case"svg":r.setHeader("Content-Type","image/svg+xml");break;case"pdf":r.setHeader("Content-Type","application/pdf");break;case"ico":r.setHeader("Content-Type","image/x-icon");break;case"jpg":case"jpeg":r.setHeader("Content-Type","image/jpeg");break;case"png":r.setHeader("Content-Type","image/png");break;case"gif":r.setHeader("Content-Type","image/gif");break;case"webp":r.setHeader("Content-Type","image/webp");break;case"mp3":r.setHeader("Content-Type","audio/mpeg");break;case"wav":r.setHeader("Content-Type","audio/wav");break;case"mp4":r.setHeader("Content-Type","video/mp4");break;case"webm":r.setHeader("Content-Type","video/webm");case"zip":r.setHeader("Content-Type","application/zip");break;case"7z":r.setHeader("Content-Type","application/x-7z-compressed");break;default:r.setHeader("Content-Type","text/plain")}}import O from"fs";import L from"path";function j(r){let e=r;return e.send=function(t,o){if(e.headersSent)return e;let s;return typeof t=="string"&&O.existsSync(t)?(s=L.extname(t).toLowerCase().slice(1),m(e,s),O.createReadStream(t).pipe(e),e):(typeof t=="string"?(t.trim().startsWith("<")&&t.trim().endsWith(">")?s="html":s="text",m(e,s),o?e.end(t,o):e.end(t)):typeof t=="object"&&!Buffer.isBuffer(t)?(s="json",m(e,s),e.end(JSON.stringify(t))):Buffer.isBuffer(t)?(s="binary",m(e,s),o?e.end(t,o):e.end(t)):(s="text",m(e,s),o?e.end(String(t),o):e.end(String(t))),e)},e.locals={},e}var C=class{middlewares;router;requestHandler;server;constructor(){this.middlewares=[],this.router=new E,this.requestHandler=new k(this.middlewares,this.router),this.server=A.createServer((e,t)=>{let o=e,s=j(t);this.requestHandler.handleRequest(o,s)})}use(e){this.middlewares.push(e)}json(){return P}upload(e){return B(e)}get(e,...t){this.router.get(e,...t)}post(e,...t){this.router.post(e,...t)}put(e,...t){this.router.put(e,...t)}patch(e,...t){this.router.patch(e,...t)}delete(e,...t){this.router.delete(e,...t)}listen(e,t){this.server.listen(e,t)}},le=C;export{le as default};
