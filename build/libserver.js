import J from"node:http";var I=class{routes;constructor(){this.routes=[]}add(e,t,o){let r=o.pop();this.routes.push({method:e,path:t,middlewares:o,middleware:r})}find(e){let{method:t,url:o,params:r}=e;if(!o)return;let n=this.routes.find(i=>{let d=new RegExp("^"+i.path.replace(/\/:([^\/]+)/g,"/([^/]+)")+"$");return t===i.method&&d.test(o.split("?")[0])});if(n){let i=o.split("?")[0].match(new RegExp(n.path.replace(/\/:([^\/]+)/g,"/([^/]+)")));if(i){let d=(n.path.match(/\/:([^\/]+)/g)||[]).map(p=>p.replace("/:",""));e.params=e.params||{},d.forEach((p,u)=>{e.params[p]=i[u+1]})}}return n}get(e,...t){this.add("GET",e,t)}post(e,...t){this.add("POST",e,t)}put(e,...t){this.add("PUT",e,t)}patch(e,...t){this.add("PATCH",e,t)}delete(e,...t){this.add("DELETE",e,t)}},B=I;var c=class{parse(e){let t=e.secure?"https":e.headers["x-forwarded-proto"]||"http",o=e.url?new URL(e.url,`${t}://${e.headers.host}`):new URL(`${t}://${e.headers.host}`);return Object.fromEntries(o.searchParams.entries())}};var f=class{async process(e,t,o){let r=o.find(e);if(!r){t.statusCode=404,t.end("Not Found");return}try{for(let n of r.middlewares)await new Promise((i,d)=>{n(e,t,p=>p?d(p):i())});r.middleware?r.middleware(e,t,()=>{}):(t.statusCode=500,t.end("Internal Server Error: No controller provided"))}catch(n){let i=n instanceof Error?n.message:"Unknown Error";t.statusCode=500,t.end(`Internal Server Error: ${i}`)}}};var R=class{constructor(e,t,o=new c,r=new f){this.middlewares=e;this.router=t;this.queryParams=o;this.processRouter=r}async handleRequest(e,t){e.params={},e.query=this.queryParams.parse(e);for(let o of this.middlewares)await new Promise((r,n)=>{o(e,t,i=>i?n(i):r())});await this.processRouter.process(e,t,this.router)}},O=R;var $=async(s,e,t)=>{if((s.method==="POST"||s.method==="PUT"||s.method==="PATCH")&&s.headers["content-type"]?.startsWith("application/json"))try{s.body=await new Promise((o,r)=>{let n="";s.on("data",i=>{n+=i.toString()}),s.on("end",()=>{try{o(JSON.parse(n))}catch(i){r(i)}}),s.on("error",i=>{r(i)})})}catch(o){o instanceof Error?(e.statusCode=400,e.end(`Erro no parse do JSON: ${o.message}`)):(e.statusCode=400,e.end("Erro desconhecido no parse do JSON"));return}t()},T=$;import y from"fs";import S from"path";var F=s=>{let e=S.resolve(s.path);return y.existsSync(e)||y.mkdirSync(e,{recursive:!0}),(t,o,r)=>{if(o.locals||(o.locals={}),t.method==="POST"&&t.headers["content-type"]&&t.headers["content-type"].startsWith("multipart/form-data")){let i=t.headers["content-type"]?.split("; ")[1]?.replace("boundary=","");if(!i)return o.statusCode=400,o.end("Boundary ausente no content-type");let d=[],p=0,u=s.maxFileSize||50*1024*1024;t.on("data",a=>{if(p+=a.length,p>u)return o.statusCode=413,o.end("Arquivo muito grande");d.push(a)}),t.on("end",()=>{try{let a=Buffer.concat(d),h=Buffer.from(`--${i}`),l=0,g=[];for(;(l=a.indexOf(h,l))!==-1;){l+=h.length;let v=a.indexOf(h,l),x=a.slice(l,v!==-1?v:a.length),w=x.indexOf(`\r
\r
`);if(w===-1)break;let k=x.slice(0,w).toString("utf8"),N=x.slice(w+4),M=k.match(/filename="([^"]+)"/);if(M){let E=M[1],U=s.format||S.extname(E),j=E;j+=U;let P=S.join(e,j);y.writeFileSync(P,N),g.push(P)}if(v===-1)break}t.files=g,o.locals.uploadedFilePaths=g,r()}catch(a){console.error("Erro no upload:",a),o.statusCode=500,o.end("Erro no upload")}}),t.on("error",a=>{console.error("Erro no upload:",a),o.statusCode=500,o.end("Erro no upload")})}else r()}},z=F;var L={json:"application/json",html:"text/html",text:"text/plain",binary:"application/octet-stream",css:"text/css",js:"application/javascript",xml:"application/xml",svg:"image/svg+xml",pdf:"application/pdf",ico:"image/x-icon",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",zip:"application/zip","7z":"application/x-7z-compressed",ttf:"font/ttf",otf:"font/otf",woff:"font/woff",woff2:"font/woff2",csv:"text/csv",rtf:"application/rtf",tar:"application/x-tar",rar:"application/vnd.rar",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",epub:"application/epub+zip",jsonld:"application/ld+json",md:"text/markdown",xhtml:"application/xhtml+xml",bz:"application/x-bzip",bz2:"application/x-bzip2",sh:"application/x-sh",csh:"application/x-csh",jar:"application/java-archive",xul:"application/vnd.mozilla.xul+xml",azw:"application/vnd.amazon.ebook",webma:"audio/webm",ogg:"audio/ogg",videoOgg:"video/ogg",odt:"application/vnd.oasis.opendocument.text",ods:"application/vnd.oasis.opendocument.spreadsheet",odp:"application/vnd.oasis.opendocument.presentation",tiff:"image/tiff",bmp:"image/bmp",atom:"application/atom+xml",avi:"video/x-msvideo",ics:"text/calendar",midi:"audio/midi",mpeg:"video/mpeg",swf:"application/x-shockwave-flash",torrent:"application/x-bittorrent",yaml:"text/yaml",heic:"image/heic",heif:"image/heif",apk:"application/vnd.android.package-archive",avif:"image/avif",psd:"image/vnd.adobe.photoshop",mpkg:"application/vnd.apple.installer+xml",webmanifest:"application/manifest+json"};function m(s,e){let t=L[e]||"text/plain";s.setHeader("Content-Type",t)}import C from"fs";import A from"path";function H(s){let e=s;return e.send=function(t,o){if(e.headersSent)return e;let r;return typeof t=="string"&&C.existsSync(t)?(r=A.extname(t).toLowerCase().slice(1),m(e,r),C.createReadStream(t).pipe(e),e):(typeof t=="string"?(t.trim().startsWith("<")&&t.trim().endsWith(">")?r="html":r="text",m(e,r),o?e.end(t,o):e.end(t)):typeof t=="object"&&!Buffer.isBuffer(t)?(r="json",m(e,r),e.end(JSON.stringify(t))):Buffer.isBuffer(t)?(r="binary",m(e,r),o?e.end(t,o):e.end(t)):(r="text",m(e,r),o?e.end(String(t),o):e.end(String(t))),e)},e.locals={},e}var b=class{middlewares;router;requestHandler;server;constructor(){this.middlewares=[],this.router=new B,this.requestHandler=new O(this.middlewares,this.router),this.server=J.createServer((e,t)=>{let o=e,r=H(t);this.requestHandler.handleRequest(o,r)})}use(e){this.middlewares.push(e)}json(){return T}upload(e){return z(e)}get(e,...t){this.router.get(e,...t)}post(e,...t){this.router.post(e,...t)}put(e,...t){this.router.put(e,...t)}patch(e,...t){this.router.patch(e,...t)}delete(e,...t){this.router.delete(e,...t)}listen(e,t){this.server.listen(e,t)}},ce=b;export{ce as default};
